- hosts: "*"
  become: true
  tasks:
    - name: Clone virtual-machine with cloud-init
      community.general.proxmox_kvm:
        api_user: ansible@pve
        api_password: Ch0c0Late$-1359!
        api_host: phs-hv-01
        clone: UBUNTU-22.04-TEMPLATE
        vmid: 1000
        name: VM-DOCKER-TEST
        node: phs-hv-01
        storage: pool-1
        format: raw
        timeout: 300

    - name: Edit new virtual-machine with new disk size and cloud-init parameters
      community.general.proxmox_kvm:
        api_user: ansible@pve
        api_password: Ch0c0Late$-1359!
        api_host: phs-hv-01
        name: VM-DOCKER-TEST
        node: phs-hv-01
        tags: 'docker,web-applications'
        scsi:
          scsi0: 'size=100'
        citype: nocloud
        ciuser: abeckett
        cipassword: Chocolate-1245!
        searchdomains: 'homelab.internal'
        nameservers: 192.168.0.210,192.168.0.1
        ipconfig: 
          ipconfig0: 'gw=192.168.0.1,ip=192.168.0.220/24'
        update: true

    - name: Start virtual-machine
      community.general.proxmox_kvm:
        node: phs-hv-01
        api_user: ansible@pve
        api_password: Ch0c0Late$-1359!
        api_host: phs-hv-01
        name: VM-DOCKER-TEST
        state: started
